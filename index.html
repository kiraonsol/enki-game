<!DOCTYPE html>
<html style="background-color: black;">
<head>
  <title>ENKI</title>
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-database.js";
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBlTVNMSh1hCjzLLu5SV4XJZRfyOZgLMVc",
      authDomain: "enki-game.firebaseapp.com",
      databaseURL: "https://enki-game-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "enki-game",
      storageBucket: "enki-game.firebasestorage.app",
      messagingSenderId: "902253472756",
      appId: "1:902253472756:web:eea22ee4ee0021ad2fe7a1"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    window.database = getDatabase(app); // Expose database globally for sketch.js
    window.firebaseReady = true; // Signal that Firebase is ready
    console.log('Firebase initialized, database ready:', window.database);
  </script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script> <!-- Telegram WebApp support -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: black;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
    #nameInputOverlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      padding: 20px;
      border-radius: 10px;
      display: none;
      z-index: 10;
    }
    #nameInputOverlay input {
      width: 200px;
      padding: 5px;
      font-size: 16px;
      margin-bottom: 10px;
    }
    #nameInputOverlay button {
      padding: 5px 15px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div id="nameInputOverlay">
    <h2>Enter Your Name</h2>
    <p>Score: <span id="currentScore">0</span></p>
    <input type="text" id="nameInput" maxlength="10" placeholder="Your name (max 10 chars)">
    <button onclick="submitName()">Submit</button>
  </div>
  <script src="sketch.js"></script>
  <script>
    // Global variables for communication between index.html and sketch.js
    window.gameState = "start";
    window.playerScore = 0;
    window.playerName = "";

    // Function to show/hide name input overlay
    function showNameInput(score) {
      document.getElementById('nameInputOverlay').style.display = 'block';
      document.getElementById('currentScore').textContent = score;
      document.getElementById('nameInput').value = "";
      window.gameState = "nameInput";
    }

    function hideNameInput() {
      document.getElementById('nameInputOverlay').style.display = 'none';
      window.gameState = "gameover";
    }

    function submitName() {
      const name = document.getElementById('nameInput').value.trim();
      if (name.length > 0) {
        window.playerName = name.substring(0, 10); // Limit to 10 chars
        if (window.addToLeaderboard) {
          window.addToLeaderboard(window.playerName, window.playerScore);
        }
        hideNameInput();
      }
    }

    // Expose functions to sketch.js
    window.showNameInput = showNameInput;
    window.hideNameInput = hideNameInput;
  </script>
</body>
</html>
